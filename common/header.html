
<script src="https://unpkg.com/markerjs"></script>



  
 <script>

let previousState
  function showMarkerJs(img, config) {
      
      let mark = new markerjs.MarkerArea(img, {previousState: config});
  
    
      //Makes sure markerjs toolbar is closed after preview topic is closed.
          function checkOpen(){ 
              if(!$(img).is(':visible')) {
              try{
                    clearInterval(timer) 
                    mark.close();
                    console.log("closed")
                    }
                  catch(e)
                  {/*Do nothing*/}
                  console.log("tracking toolbar")
                 }
            } 
          let timer = setInterval(checkOpen,1900);

          disableScroll();

            mark.show((dataUrl, ) => {
                img.src = dataUrl;
                
                // $('.d-editor-textarea-wrapper textarea').val('![]('+dataUrl+')');
            });   

            newObj = {
                img,
                previousState: mark.getState()
            }

            $('.markerjs-toolbar').on("click", function(){
              console.log("toolbar clicked")
            newObj.img = img
            newObj.previousState = mark.getState();
            console.log("saving previous state")
            return newObj
          })

           return newObj
  }



</script> 


